import React, { useState, useEffect } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";

const port = 4000;

function CreateOrder() {
  const [name, setName] = useState("");
  const [id, setID] = useState("");
  const [quantity, setQuantity] = useState("");
  const [price, setPrice] = useState("");
  const [deadLine, setDeadLine] = useState("");
  const [priceError, setPriceError] = useState("");
  const [idError, setIDError] = useState("");
  const [deadlineError, setDeadlineError] = useState("");
  const navigate = useNavigate();

  useEffect(() => {
    // Generate unique ID when component mounts
    const autoGeneratedID = generateUniqueID();
    setID(autoGeneratedID);
  }, []);

  const generateUniqueID = () => {
    // Generate a unique ID here, you can use UUID or any other method
    return Math.floor(Math.random() * 1000000).toString();
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (validateForm()) {
      axios
        .post(`http://localhost:${port}/api/supplier/request/create`, {
          name: name,
          rid: id,
          quantity: quantity,
          price: price,
          deadLine: deadLine,
        })
        .then((result) => {
          console.log(result);
          navigate("/SupplyRequest");
        })
        .catch((err) => console.log(err));
    }
  };

  const validateForm = () => {
    let isValid = true;

    if (!price.match(/^\d+(\.\d{1,2})?$/)) {
      isValid = false;
      setPriceError("Price must be a number with up to 2 decimal places");
    } else {
      setPriceError("");
    }

    if (!deadLine) {
      isValid = false;
      setDeadlineError("Deadline is required");
    } else {
      setDeadlineError("");
    }

    if (!id) {
      isValid = false;
      setIDError("Request ID is required");
    } else {
      setIDError("");
    }

    return isValid;
  };

  return (
    <div
      style={{
        marginLeft: "400px",
        marginTop: "50px",
        width: "60%",
        justifyContent: "center",
        alignItems: "center",
        height: "60vh",
        backgroundColor: "#ffffff",
        backgroundSize: "cover",
        backgroundPosition: "left",
      }}
    >
      <div
        style={{
          width: "50%",
          backgroundColor: "tomato",
          marginTop: "70px",
          opacity: "0.9",
          borderRadius: "10px",
          padding: "16px",
        }}
      >
        <form onSubmit={handleSubmit}>
          <h2>Add Supply Requests</h2>
          <div style={{ margin: "0 auto", maxWidth: "500px" }}>
            <div>
              <label htmlFor="name">Name:</label>
              <input
                type="text"
                id="name"
                placeholder="Enter Raw Material Name"
                style={{
                  padding: "8px",
                  borderRadius: "5px",
                  border: "1px solid #ccc",
                  width: "100%",
                  marginBottom: "10px",
                }}
                value={name}
                onChange={(e) => setName(e.target.value)}
              />
            </div>
            <div>
              <label htmlFor="id">Request ID:</label>
              <input
                type="text"
                id="id"

                style={{
                  padding: "8px",
                  borderRadius: "5px",
                  border: "1px solid #ccc",
                  width: "70%",
                  marginBottom: "10px",
                }}
                value={id}
                readOnly // Disable editing
              />
              <span style={{ color: "red" }}>{idError}</span>
            </div>
            <div>
              <label htmlFor="quantity">Quantity (KG & Grams):</label>
              <input
                type="text"
                id="quantity"
                placeholder="Enter Quantity"
                style={{
                  padding: "8px",
                  borderRadius: "5px",
                  border: "1px solid #ccc",
                  width: "100%",
                  marginBottom: "10px",
                }}
                value={quantity}
                onChange={(e) => setQuantity(e.target.value)}
              />
            </div>
            <div>
              <label htmlFor="price">Price (LKR):</label>
              <input
                type="text"
                id="price"
                placeholder="Enter Price Per KG"
                style={{
                  padding: "8px",
                  borderRadius: "5px",
                  border: "1px solid #ccc",
                  width: "100%",
                  marginBottom: "10px",
                }}
                value={price}
                onChange={(e) => setPrice(e.target.value)}
              />
              <span style={{ color: "red" }}>{priceError}</span>
            </div>
            <div>
              <label htmlFor="deadline">Deadline:</label>
              <input
                type="date"
                id="deadline"
                placeholder="Select Deadline"
                style={{
                  padding: "8px",
                  borderRadius: "5px",
                  border: "1px solid #ccc",
                  width: "100%",
                  marginBottom: "10px",
                }}
                value={deadLine}
                onChange={(e) => setDeadLine(e.target.value)}
              />
              <span style={{ color: "red" }}>{deadlineError}</span>
            </div>
            <button
              type="submit"
              style={{
                padding: "10px 20px",
                backgroundColor: "#28a745",
                color: "#fff",
                border: "none",
                borderRadius: "5px",
                cursor: "pointer",
              }}
            >
              Submit
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

export default CreateOrder;
